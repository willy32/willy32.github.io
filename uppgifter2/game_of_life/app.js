const canvas = document.getElementById("game");
const context = game.getContext("2d");

canvas.width = 800;
canvas.height = 800;

let grid = [
    ["","","","","","","","","","","","","","","","","","","",""],
    ["","","","","","","","","","","","","","","","","","","",""],
    ["","","","","","","","","","","","","","","","","","","",""],
    ["","","","","","","","","","","","","","","","","","","",""],
    ["","","","","","","","","","","","","","","","","","","",""],
    ["","","","","","","","","r","","","","","","","","","","",""],
    ["","","","","","","","r","r","r","","","","","","","","","",""],
    ["","","","","","","","","r","","","","","","","","","","",""],
    ["","","","","","","","","","","","","","","","","","","",""],
    ["","","","","","","","","","","","","","","","","","","",""],
    ["","","","","","","","","","","","","","","","","","","",""],
    ["","","","","","","","","","","","","","","","","","","",""],
    ["","","","","","","","","","","","","","","","","","","",""],
    ["","","","","","","","","","","","","","","","","","","",""],
    ["","","","","","","","","","","","","","","","","","","",""],
    ["","","","","","","","","","","","","","","","","","","",""],
    ["","","","","","","","","","","","","","","","","","","",""],
    ["","","","","","","","","","","","","","","","","","","",""],
    ["","","","","","","","","","","","","","","","","","","",""],
    ["","","","","","","","","","","","","","","","","","","",""],
];

function DrawGrid(context, grid){
    context.clearRect(0, 0, canvas.width, canvas.height);
    

    const tileWidth = canvas.width / grid[0].length;
    const tileHeight = canvas.height / grid.length;

    grid.forEach((row, y) => {
        row.forEach((tile, x) => {
            if(tile != ""){
                console.log("Draw");

                context.fillStyle='red';
                
                context.fillRect((x * tileWidth), (y * tileHeight), tileWidth, tileHeight);
                
            }else{
                context.fillStyle='gray';
                context.fillRect((x * tileWidth), (y * tileHeight), tileWidth, tileHeight);
            }
        });
    });
}

function NextStep(grid){
    let newGrid = [
        ["","","","","","","","","","","","","","","","","","","",""],
        ["","","","","","","","","","","","","","","","","","","",""],
        ["","","","","","","","","","","","","","","","","","","",""],
        ["","","","","","","","","","","","","","","","","","","",""],
        ["","","","","","","","","","","","","","","","","","","",""],
        ["","","","","","","","","","","","","","","","","","","",""],
        ["","","","","","","","","","","","","","","","","","","",""],
        ["","","","","","","","","","","","","","","","","","","",""],
        ["","","","","","","","","","","","","","","","","","","",""],
        ["","","","","","","","","","","","","","","","","","","",""],
        ["","","","","","","","","","","","","","","","","","","",""],
        ["","","","","","","","","","","","","","","","","","","",""],
        ["","","","","","","","","","","","","","","","","","","",""],
        ["","","","","","","","","","","","","","","","","","","",""],
        ["","","","","","","","","","","","","","","","","","","",""],
        ["","","","","","","","","","","","","","","","","","","",""],
        ["","","","","","","","","","","","","","","","","","","",""],
        ["","","","","","","","","","","","","","","","","","","",""],
        ["","","","","","","","","","","","","","","","","","","",""],
        ["","","","","","","","","","","","","","","","","","","",""],
    ];

    grid.forEach((row, y) => {
        row.forEach((tile, x) => {
            if(tile != ""){
                let neighbors = -1;
                //newGrid[y][x] = tile;

                try{
                    for (let oY = -1; oY < 2; oY++) {
                        for (let oX = -1; oX < 2; oX++) {
                            if(grid[y + oY][x + oX] != "" && grid[y + oY][x + oX] != undefined) neighbors++;
                        }
                    }

                }catch(Ex){
                    //console.log(Ex);
                }
                console.log(neighbors);

                if(neighbors <= 1) newGrid[y][x] = "";
                if(neighbors >= 4) newGrid[y][x] = "";
                if(neighbors == 2 || neighbors == 3) newGrid[y][x] = tile;

            }else{
                let neighbors = 0;
                try{
                    for (let oY = -1; oY < 2; oY++) {
                        for (let oX = -1; oX < 2; oX++) {
                            if(grid[y + oY][x + oX] != "" && grid[y + oY][x + oX] != undefined) neighbors++;
                        }
                    }

                }catch(Ex){
                    //console.log(Ex);
                }
                if(neighbors == 3) newGrid[y][x] = "r";
            }
        });
    });

    return newGrid;
}

DrawGrid(context, grid);
for (let i = 0; i < 6; i++) {
    grid = NextStep(grid);
}
DrawGrid(context, grid);